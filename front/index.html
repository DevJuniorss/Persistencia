<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Manager</title>
  <style>
    :root{--accent:#007bff;--danger:#dc3545;--bg:#f7f7f7;--card:#ffffff}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:24px}
    .wrap{max-width:900px;margin:0 auto}
    h1{margin:0 0 18px;font-size:28px}
    .card{background:var(--card);border-radius:8px;padding:16px;margin-bottom:16px;box-shadow:0 1px 0 rgba(0,0,0,0.06)}
    .row{display:flex;gap:8px;align-items:center}
    input[type=text],input[type=number]{padding:8px;border:1px solid #ccc;border-radius:4px;flex:1}
    button{padding:8px 12px;border-radius:4px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    button.danger{background:var(--danger)}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .stat{background:#fafafa;padding:10px;border-radius:6px;border:1px solid #eee}
    .list .item{padding:10px;border:1px solid #eee;border-radius:6px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px;color:#555}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Product Manager</h1>
    <div class="card">
      <div class="row">
        <input id="name" type="text" placeholder="Product name">
        <input id="price" type="number" placeholder="Price" step="0.01">
        <button id="addBtn">Add Product</button>
      </div>
    </div>
    <div class="card">
      <h3>Statistics</h3>
      <div class="stats">
        <div class="stat">Highest: <span id="highest">-</span></div>
        <div class="stat">Lowest: <span id="lowest">-</span></div>
        <div class="stat">Average: <span id="average">-</span></div>
      </div>
    </div>
    <div class="card">
      <h3>All Products (<span id="count">0</span>)</h3>
      <div id="allList" class="list"></div>
    </div>
    <div class="card">
      <h3>Above Average (<span id="aboveCount">0</span>)</h3>
      <div id="aboveList" class="list"></div>
    </div>
    <div class="card">
      <h3>Below Average (<span id="belowCount">0</span>)</h3>
      <div id="belowList" class="list"></div>
    </div>
  </div>
  <script>
    const base = 'http://127.0.0.1:8000';
    async function getJson(path){
      const res = await fetch(base + path);
      if(!res.ok) throw new Error('request failed');
      return await res.json();
    }
    async function postProduct(name,price){
      const url = base + '/products?name=' + encodeURIComponent(name) + '&price=' + encodeURIComponent(price);
      const res = await fetch(url,{method:'POST'});
      if(!res.ok) throw new Error('create failed');
      return await res.json();
    }
    async function deleteProduct(id){
      const res = await fetch(base + '/products/' + id,{method:'DELETE'});
      if(!res.ok) throw new Error('delete failed');
      return await res.json();
    }
    function el(id){return document.getElementById(id)}
    function formatPrice(p){return Number(p).toFixed(2)}
    async function loadAll(){
      try{
        const [products,highest,lowest,avg,above,below] = await Promise.all([
          getJson('/products'),
          getJson('/products/highest'),
          getJson('/products/lowest'),
          getJson('/products/average'),
          getJson('/products/above-average'),
          getJson('/products/below-average')
        ]);
        el('count').textContent = products.length || 0;
        el('allList').innerHTML = products.map(p=>`<div class="item"><div><strong>${p.name}</strong><div class="small">$${formatPrice(p.price)}</div></div><div><button data-id="${p.id}" class="delBtn danger">Delete</button></div></div>`).join('') || '<div class="small">No products</div>';
        el('highest').textContent = highest && highest.name ? `${highest.name} - $${formatPrice(highest.price)}` : '-';
        el('lowest').textContent = lowest && lowest.name ? `${lowest.name} - $${formatPrice(lowest.price)}` : '-';
        const avgVal = avg && (avg.average !== undefined) ? Number(avg.average) : 0;
        el('average').textContent = '$' + formatPrice(avgVal);
        el('aboveCount').textContent = (above && above.length) || 0;
        el('belowCount').textContent = (below && below.length) || 0;
        el('aboveList').innerHTML = (above && above.length) ? above.map(p=>`<div class="item"><div><strong>${p.name}</strong><div class="small">$${formatPrice(p.price)}</div></div></div>`).join('') : '<div class="small">No products</div>';
        el('belowList').innerHTML = (below && below.length) ? below.map(p=>`<div class="item"><div><strong>${p.name}</strong><div class="small">$${formatPrice(p.price)}</div></div></div>`).join('') : '<div class="small">No products</div>';
        Array.from(document.querySelectorAll('.delBtn')).forEach(b=>b.addEventListener('click',async e=>{
          const id = e.target.getAttribute('data-id');
          if(!confirm('Delete this product?')) return;
          try{ await deleteProduct(id); await loadAll(); }catch(err){ alert('Delete failed'); }
        }));
      }catch(err){ console.error(err); }
    }
    el('addBtn').addEventListener('click',async ()=>{
      const name = el('name').value.trim();
      console.log("dfjuhdfhujiihu");
      
      const price = el('price').value;
      if(!name || price === '') return;
      try{
        await postProduct(name,Number(price));
        el('name').value = '';
        el('price').value = '';
        await loadAll();
      }catch(err){ alert('Create failed'); }
    });
    window.addEventListener('load',()=>{ loadAll(); });
  </script>
</body>
</html>
